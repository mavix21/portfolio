---
import DateTimeDisplay from "@/components/DateTimeDisplay";
import BaseHead from "../components/BaseHead.astro";
import { getLangFromUrl, getLocalizedPathnames } from "../i18n/utils";
import { Menu, X } from "lucide-react";
import Navigation from "@/components/Navigation.astro";
import { ThemeSwitcher } from "@/components/ThemeSwitcher";
import LanguageSwitcher from "@/components/LanguageSwitcher";

interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const pathnames = getLocalizedPathnames(Astro.url.pathname);
---

<!doctype html>
<html lang={lang}>
  <BaseHead title={title} description={description} />
  <body>
    <div
      class="flex h-svh flex-col overflow-hidden bg-muted p-0 text-foreground md:p-2"
    >
      {/* CSS-only mobile menu toggle */}
      <input type="checkbox" id="mobile-menu-toggle" class="peer hidden" />

      {/* Mobile Header */}
      <header
        class="group relative h-14 border bg-background/95 px-4 py-2 backdrop-blur-sm md:hidden"
      >
        <div class="flex items-center justify-between">
          {/* Logo */}
          <a href="/" class="mt-1 font-serif text-2xl leading-none font-normal"
            >MV</a
          >
          <label
            for="mobile-menu-toggle"
            class="relative z-10 cursor-pointer p-2 transition-colors hover:text-foreground"
            aria-label="Toggle menu"
          >
            <Menu size={24} className="group-peer-checked:hidden" />
            <X size={24} className="hidden group-peer-checked:block" />
          </label>
        </div>
      </header>

      {/* Mobile Menu Overlay */}
      <div
        class="group mobile-menu-overlay backdrop-blur-0 invisible fixed inset-0 top-14 z-10 opacity-0 transition-all duration-300 ease-in-out peer-checked:visible peer-checked:bg-background/75 peer-checked:opacity-100 peer-checked:backdrop-blur-sm"
      >
        <div
          class="flex h-full -translate-y-full transform flex-col px-6 pt-20 transition-transform duration-300 ease-in-out group-peer-checked:translate-y-0"
        >
          <div class="flex-1 overflow-y-auto">
            <div
              class="translate-y-4 opacity-0 transition-all delay-100 duration-300 ease-in-out group-peer-checked:translate-y-0 group-peer-checked:opacity-100"
            >
              <Navigation lang={lang} />
            </div>
          </div>
          <div
            class="translate-y-4 pb-8 opacity-0 transition-all delay-200 duration-300 ease-in-out group-peer-checked:translate-y-0 group-peer-checked:opacity-100"
          >
            <div class="flex flex-col gap-4">
              <ThemeSwitcher lang={lang} className="-ml-4" client:visible />
              <LanguageSwitcher
                client:visible
                lang={lang}
                pathnames={pathnames}
                className="-ml-4"
              />
            </div>
          </div>
        </div>
      </div>

      {/* Frame border */}
      <div
        class="flex flex-1 border border-t-0 bg-background p-4 md:rounded md:border-t"
      >
        {/* Left Sidebar */}
        <div
          class="sticky top-0 z-10 hidden h-full w-64 flex-col space-y-8 border-r pr-4 md:flex"
        >
          {/* Header Section */}
          <div class="flex-shrink-0">
            <a href="/" class="font-serif text-2xl font-normal">MV</a>
            <DateTimeDisplay lang={lang} client:load />
          </div>

          {/* Separator */}
          <div class="h-px w-full bg-border"></div>

          {/* Main Navigation - Scrollable */}
          <div
            class="scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent flex-1 overflow-y-auto"
          >
            <Navigation />
          </div>

          {/* Separator */}
          <div class="h-px w-full bg-border"></div>

          {/* Footer Section */}
          <div class="flex flex-shrink-0 flex-col gap-4">
            <ThemeSwitcher lang={lang} client:load />
            <LanguageSwitcher lang={lang} pathnames={pathnames} />
          </div>
        </div>

        {/* Main Content Area */}
        <div class="flex h-full flex-1 flex-col">
          {/* Main Content */}
          <div class="flex-1 animate-fade-in-up overflow-y-auto md:pl-4">
            <slot />
          </div>

          {/* Footer */}
          <footer class="border-t border-border pt-4 md:ml-4">
            <div class="text-center text-xs text-muted-foreground">
              Â© 2024 All rights reserved
            </div>
          </footer>
        </div>
      </div>
    </div>
  </body>
</html>
